<UserControl x:Class="ccc.Controls.Cards.VideoCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ccc.Controls.Cards"
             mc:Ignorable="d" 
             d:DesignHeight="260" d:DesignWidth="320">
    
    <Border x:Name="ContainerBorder" Style="{StaticResource CardBaseStyle}" Padding="0">
        <Border.Resources>
            <Style x:Key="RoundIconBtn" TargetType="Button">
                <Setter Property="Background" Value="#99000000"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" CornerRadius="14">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#CC000000"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Border.Resources>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Thumbnail (Aspect Ratio handled by Image or Width) -->
                <RowDefinition Height="*"/>    <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Thumbnail Area -->
            <local:CardThumbnail Grid.Row="0" Height="180"
                                 Source="{Binding ThumbnailUrl}"
                                 Progress="{Binding ProgressPercentage}"
                                 HasProgress="{Binding HasProgress}"
                                 IsPlaying="{Binding IsPlaying}"
                                 IsWatched="{Binding IsWatched}"
                                 CornerRadius="12,12,0,0"/>

            <!-- Content Area -->
            <StackPanel Grid.Row="1" Margin="12,8">
                <!-- Title -->
                <TextBlock Text="{Binding Title}" 
                           FontSize="14" FontWeight="SemiBold"
                           TextTrimming="CharacterEllipsis" 
                           MaxHeight="40" TextWrapping="Wrap"/>
                
                <!-- Subtitle / ID -->
                <TextBlock Text="{Binding VideoId}" 
                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,4,0,0"
                           Visibility="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>

            <!-- Controls (Pin / Star / Menu) -->
            <!-- Note: In React, these are absolute positioned over the thumbnail or bottom.
                 We can replicate that using a Grid overlap or Canvas on Top. -->
             <Grid Grid.Row="0" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="8"
                   Visibility="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}">
                 <StackPanel Orientation="Horizontal">
                     <!-- Pin Button -->
                     <Button Style="{StaticResource RoundIconBtn}"
                             Command="{Binding DataContext.TogglePinCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                             CommandParameter="{Binding}"
                             ToolTip="Pin Video"
                             Width="28" Height="28" Margin="0,0,4,0">
                         <Path Fill="White" Data="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z" Width="12" Height="12" Stretch="Uniform"/>
                     </Button>
                     <!-- Star Button placeholder -->
                     <Button Style="{StaticResource InvisibleBtn}" Width="24" Height="24">
                         <TextBlock Text="⭐" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                     </Button>
                 </StackPanel>
             </Grid>

             <!-- Menu Button (Bottom Right of Thumbnail?) Or Content? 
                  ui.md: "Bottom Right: 3-dot menu appears" (Hover Overlay) -->
             <Grid Grid.Row="0" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="8"
                   Visibility="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}">
                 <Button Style="{StaticResource InvisibleBtn}" Width="24" Height="24">
                     <TextBlock Text="⋮" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="White"/>
                 </Button>
             </Grid>

        </Grid>
    </Border>
</UserControl>
